{"version":3,"sources":["webpack:///webpack/bootstrap e30f3c115a20fcca7e9d","webpack:///external \"mongoose\"","webpack:///./~/babel-runtime/regenerator/index.js","webpack:///./server/config/index.js","webpack:///external \"koa-router\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"md5\"","webpack:///./nuxt.config.js","webpack:///./server/routes/index.js","webpack:///external \"@koa/cors\"","webpack:///external \"koa\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-static\"","webpack:///external \"nuxt\"","webpack:///./server/controllers/article.js","webpack:///./server/controllers/tag.js","webpack:///./server/controllers/user.js","webpack:///./server/middlewares/check-token.js","webpack:///./server/models/article.js","webpack:///./server/models/index.js","webpack:///./server/models/tag.js","webpack:///./server/models/user.js","webpack:///./server/robots.js","webpack:///./server/rss.js","webpack:///./server/sitemap.js","webpack:///external \"axios\"","webpack:///external \"formidable\"","webpack:///external \"fs\"","webpack:///external \"os\"","webpack:///external \"path\"","webpack:///external \"regenerator-runtime\"","webpack:///./server/index.js"],"names":["user","role","username","password","email","nickname","motto","avatar","jwt","secret","mongodb","host","database","port","production","domain","app","routerBaseApi","module","exports","head","meta","charset","name","content","link","rel","type","href","title","css","loading","color","build","vendor","extend","config","ctx","isClient","rules","push","enforce","test","loader","exclude","manifest","description","theme_color","modules","plugins","src","ssr","router","require","tag","article","rss","baseUrl","articleApi","get","next","axios","then","ret","data","getRssBodyFromBody","siteUrl","res","end","sitemap","getSitemapFromBody","robots","getRobotsFromConfig","getUserInfo","patch","patchUserInfo","post","login","logout","getTagsOrArticles","postTag","patchTag","del","deleteTag","search","getArticle","getArticles","getPrivateArticles","archives","postArticle","upload","patchArticle","deleteArticle","Article","mongoose","model","params","page","limit","Number","find","publish","exec","total","length","populate","path","select","skip","sort","body","success","err","id","findOne","_id","findByIdAndUpdate","views","request","String","save","updatedAt","Date","now","findByIdAndRemove","keyword","reg","RegExp","$or","$regex","articles","arr","arr2","year","month","date","i","createdAt","getFullYear","getMonth","archiveArticles","j","getImgUrl","Promise","resolve","reject","form","parse","req","fields","files","console","log","lastItem","Object","keys","extname","oldUrl","newUrl","readStream","fs","createReadStream","writeStream","createWriteStream","pipe","imgUrl","protocol","formidable","IncomingForm","url","Tag","tags","User","md5","expiresIn","token","sign","userID","cookies","set","avatarUrl","oldPassword","newPassword","findOneAndUpdate","decoded","verify","Schema","ArticleSchema","Boolean","default","flag","like","Array","comments","Types","ObjectId","ref","options","toJSON","virtuals","versionKey","transform","doc","mongoUrl","global","connection","openUri","once","userInfo","on","error","warn","TagSchema","UserSchema","getUpdatedDate","tail","result","reduce","prev","curr","toUTCString","replace","slice","process","env","HOST","globalConfig","PORT","use","cors","bodyParser","KoaStatic","route","routes","allowedMethods","dev","nuxt","builder","status","render","promise","catch","listen","start"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 30);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap e30f3c115a20fcca7e9d","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/regenerator/index.js\n// module id = 1\n// module chunks = 0","export default {\n  user: {\n    role: 'superAdmin',\n    username: 'q',\n    password: 'q',\n    email: '178848890@qq.com',\n    nickname: 'NuxtBlog-V1',\n    motto: 'Never too old to learn',\n    avatar: 'avatar.png'\n  },\n  jwt: {\n    secret: 'NuxtBlog-V1'\n  },\n  mongodb: {\n    host: '127.0.0.1',\n    database: 'NuxtBlog-V1',\n    port: 27017,\n    username: '',\n    password: ''\n  },\n  production: {\n    host: '',\n    // host: '198.13.32.165',\n    // domain: ''\n    domain: 'http://127.0.0.1:3001'\n  },\n  app: {\n    host: '127.0.0.1',\n    port: 3001,\n    routerBaseApi: 'api'\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/config/index.js","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"md5\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"md5\"\n// module id = 5\n// module chunks = 0","module.exports = {\n  head: {\n    meta: [\n      { charset: 'utf-8' },\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\n      { name: 'renderer', content: 'webkit' },\n      { name: 'keywords', content: 'NuxtBlog-V1, Vuejs, Nodejs, 服务端渲染' }\n    ],\n    link: [\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' },\n      { rel: 'alternate', type: 'application/rss+xml', title: 'RSS 2.0', href: '/rss.xml' },\n      { rel: 'stylesheet', type: 'text/css', href: '//at.alicdn.com/t/font_620064_9otr4k6uaufbhuxr.css' }/* ,\n      { rel: 'stylesheet', href: 'https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css' } */\n    ]/* ,\n    script: [\n      { src: 'https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js' }\n    ] */\n  },\n  css: ['~assets/css/main.css', 'highlight.js/styles/github.css'],\n  loading: { color: '#42B983' },\n  build: {\n    vendor: ['axios'],\n    extend(config, ctx) {\n      if (ctx.isClient) {\n        config.module.rules.push({\n          enforce: 'pre',\n          test: /\\.(js|vue)$/,\n          loader: 'eslint-loader',\n          exclude: /(node_modules)/\n        })\n      }\n    }\n  },\n  manifest: {\n    name: 'NuxtBlog-V1',\n    description: 'A blog system',\n    theme_color: '#42B983'\n  },\n  modules: ['@nuxtjs/pwa', '@nuxtjs/axios'],\n  plugins: ['~/plugins/components.js', '~/plugins/filters.js',\n    { src: '~/plugins/gitalk.js', ssr: false }\n  ]\n}\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js","import axios from 'axios'\nimport Router from 'koa-router'\nimport config from '../config'\nimport db from '../models'\nimport checkToken from '../middlewares/check-token'\nimport { getRssBodyFromBody } from '../rss'\nimport { getSitemapFromBody } from '../sitemap'\nimport getRobotsFromConfig from '../robots'\n\nconst router = new Router()\nconst user = require('../controllers/user')\nconst tag = require('../controllers/tag')\nconst article = require('../controllers/article')\n\n// rss\nlet rss = ''\nlet baseUrl = `http://${config.app.host}:${config.app.port}`\nif (process.env.NODE_ENV === 'production') {\n  baseUrl = config.production.domain\n}\nlet articleApi = `${baseUrl}/${config.app.routerBaseApi}/articles`\nrouter.get('/rss.xml', async (ctx, next) => {\n  await axios.get(articleApi).then((ret) => {\n    const {data} = ret\n    rss = getRssBodyFromBody(data, {\n      title: 'NuxtBlog-V1',\n      siteUrl: baseUrl,\n      description: 'NuxtBlog-V1'\n    })\n  })\n  ctx.type = 'application/xml'\n  ctx.res.end(rss)\n})\n\n// sitemap\nlet sitemap = ''\nrouter.get('/sitemap.xml', async (ctx, next) => {\n  await axios.get(articleApi).then((ret) => {\n    const {data} = ret\n    sitemap = getSitemapFromBody(data, {\n      siteUrl: baseUrl\n    })\n  })\n  ctx.type = 'application/xml'\n  ctx.res.end(sitemap)\n})\n\n// robots\nlet robots = ''\nrouter.get('/robots.txt', (ctx, next) => {\n  robots = getRobotsFromConfig({\n    siteUrl: baseUrl\n  })\n  ctx.res.end(robots)\n})\n\nrouter\n  .get('/api/user', user.getUserInfo)\n  .patch('/api/user', checkToken, user.patchUserInfo)\n  .post('/api/login', user.login)\n  .post('/api/logout', checkToken, user.logout)\n\nrouter\n  .get('/api/tags/:id?', tag.getTagsOrArticles)\n  .post('/api/tag', checkToken, tag.postTag)\n  .patch('/api/tag', checkToken, tag.patchTag)\n  .del('/api/tag/:id?', checkToken, tag.deleteTag)\n\nrouter\n  .get('/api/search/:keyword?', article.search)\n  .get('/api/article/:id?', article.getArticle)\n  .get('/api/articles/:page?/:limit?', article.getArticles)\n  .get('/api/private-articles', checkToken, article.getPrivateArticles)\n  .get('/api/archives', article.archives)\n  .post('/api/article', checkToken, article.postArticle)\n  .post('/api/upload', checkToken, article.upload)\n  .patch('/api/article', checkToken, article.patchArticle)\n  .del('/api/article/:id?', checkToken, article.deleteArticle)\n\nexport default router\n\n\n\n// WEBPACK FOOTER //\n// ./server/routes/index.js","module.exports = require(\"@koa/cors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@koa/cors\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"koa-bodyparser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-bodyparser\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"koa-static\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-static\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 12\n// module chunks = 0","import mongoose from 'mongoose'\nimport path from 'path'\nimport os from 'os'\nimport fs from 'fs'\nimport formidable from 'formidable'\nconst Article = mongoose.model('Article')\n\nexport const getArticles = async(ctx, next) => {\n  let { page = 1, limit = 15 } = ctx.params\n  page = Number((page - 1) * limit) || 0\n  limit = Number(limit) || 15\n\n  try {\n    let total = await Article.find({ publish: true }).exec()\n    total = total.length\n    const data = await Article.find({ publish: true })\n      .populate({\n        path: 'tags',\n        select: 'id name'\n      })\n      .skip(page)\n      .limit(limit)\n      .sort({'createdAt': -1})\n      .exec()\n    ctx.body = {\n      success: true,\n      data: data,\n      total: total\n    }\n  } catch (e) {\n    ctx.body = {\n      success: false,\n      err: e,\n      total: 0\n    }\n  }\n}\n\nexport const getPrivateArticles = async(ctx, next) => {\n  const data = await Article.find({ publish: false })\n    .populate({\n      path: 'tags',\n      select: 'id name'\n    })\n    .sort({'updatedAt': -1})\n    .exec()\n  ctx.body = {\n    success: true,\n    data: data\n  }\n}\n\nexport const getArticle = async(ctx, next) => {\n  let { id } = ctx.params\n  if (!id) {\n    return (ctx.body = {\n      success: false,\n      err: 'id is required'\n    })\n  }\n\n  try {\n    let article = await Article.findOne({ _id: id })\n      .populate({\n        path: 'tags',\n        select: 'id name'\n      })\n      .exec()\n    await Article.findByIdAndUpdate(id, {views: article.views + 1}).exec()\n    ctx.body = {\n      success: true,\n      data: article\n    }\n  } catch (e) {\n    // console.log(e)\n    ctx.body = {\n      success: false,\n      err: e\n    }\n  }\n}\n\nexport const postArticle = async(ctx, next) => {\n  let body = ctx.request.body\n  let { title, content, publish } = body\n  if (!title || !content || !String(publish)) {\n    return (ctx.body = {\n      success: false,\n      err: 'Field incomplete'\n    })\n  }\n\n  try {\n    body = await new Article(body)\n    await body.save()\n    // when save article, we can replace id to object\n    // await body.populate('tags').execPopulate()\n    ctx.body = {\n      success: true,\n      data: body\n    }\n  } catch (e) {\n    ctx.body = {\n      success: false,\n      err: e\n    }\n  }\n}\n\n// modify publish article or private article\nexport const patchArticle = async(ctx, next) => {\n  let body = ctx.request.body\n  body.updatedAt = Date.now()\n  let { id, title, content, publish } = body\n  if (!id || !title || !content || !String(publish)) {\n    return (ctx.body = {\n      success: false,\n      err: 'Field incomplete'\n    })\n  }\n\n  try {\n    body = await Article.findByIdAndUpdate(id, body).exec()\n    ctx.body = {\n      success: true,\n      data: body\n    }\n  } catch (e) {\n    ctx.body = {\n      success: false,\n      err: e\n    }\n  }\n}\n\nexport const deleteArticle = async(ctx, next) => {\n  let { id } = ctx.params\n\n  if (!id) {\n    return (ctx.body = {\n      success: false,\n      err: 'id is required'\n    })\n  }\n\n  try {\n    let body = await Article.findByIdAndRemove(id).exec()\n    ctx.body = {\n      success: true,\n      data: body\n    }\n  } catch (e) {\n    ctx.body = {\n      success: false,\n      err: e\n    }\n  }\n}\n\nexport const search = async(ctx, next) => {\n  const { keyword } = ctx.params\n  const reg = new RegExp(keyword, 'i')\n  try {\n    let body = await Article.find({\n      publish: true,\n      $or: [{ title: { $regex: reg } }]\n    })\n    .sort({'createdAt': -1})\n    .exec()\n    ctx.body = {\n      success: true,\n      data: body\n    }\n  } catch (e) {\n    ctx.body = {\n      success: false,\n      err: e\n    }\n  }\n}\n\nexport const archives = async(ctx, next) => {\n  let articles = await Article.find({ publish: true })\n    .populate({\n      path: 'tags',\n      select: 'id name'\n    })\n    .select('id title tags createdAt updatedAt')\n    .sort({'createdAt': -1})\n    .exec()\n  let arr = [],\n    arr2 = [],\n    year, month, date\n  for (let i = 0; i < articles.length; i++) {\n    year = new Date(articles[i].createdAt).getFullYear() + ''\n    month = new Date(articles[i].createdAt).getMonth() + 1 + ''\n    if (month.length === 1) {\n      month = '0' + month\n    }\n    date = `${year}年${month}月`\n    arr.push({\n      date: date,\n      article: articles[i]\n    })\n  }\n\n  for (let i = 0; i < arr.length;) {\n    let total = 0,\n      archiveArticles = []\n    for (let j = i; j < arr.length; j++) {\n      if (arr[i].date === arr[j].date) {\n        archiveArticles.push(arr[j].article)\n        total++\n      }\n    }\n    arr2.push({\n      date: arr[i].date,\n      articles: archiveArticles,\n      total: total\n    })\n    i += total\n  }\n\n  ctx.body = {\n    success: true,\n    data: arr2\n  }\n}\n\nexport const upload = async(ctx, next) => {\n  let form = new formidable.IncomingForm()\n\n  function getImgUrl(ctx) {\n    return new Promise((resolve, reject) => {\n      form.parse(ctx.req, function (err, fields, files) {\n        if (err) {\n          console.log(err)\n          reject(err)\n        }\n        // console.log(files)\n        let lastItem = files[Object.keys(files)[Object.keys(files).length - 1]]\n\n        // fetch file extname\n        let extname = Date.now() + path.extname(lastItem.name)\n        let oldUrl = lastItem.path\n        let newUrl = './public/' + extname\n\n        // modify file name and upload file\n        let readStream = fs.createReadStream(oldUrl)\n        let writeStream = fs.createWriteStream(newUrl)\n        readStream.pipe(writeStream)\n        let imgUrl = ctx.protocol + '://' + ctx.host + '/public/' + extname\n        resolve(imgUrl)\n      })\n    })\n  }\n\n  await getImgUrl(ctx).then((url) => {\n    ctx.body = url\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/article.js","import mongoose from 'mongoose'\nconst Tag = mongoose.model('Tag')\nconst Article = mongoose.model('Article')\nexport const getTagsOrArticles = async(ctx, next) => {\n  let { id } = ctx.params, data\n  if (id) {\n    try {\n      data = await Article.find({ publish: true, tags: [id] })\n        .populate({\n          path: 'tags',\n          select: 'id name'\n        })\n        .sort({ 'updatedAt': -1 })\n        .exec()\n      ctx.body = {\n        success: true,\n        data: data\n      }\n    } catch (e) {\n      ctx.body = {\n        success: false,\n        err: e\n      }\n    }\n  } else {\n    data = await Tag.find({}).sort({ 'updatedAt': -1 }).exec()\n    ctx.body = {\n      success: true,\n      data: data\n    }\n  }\n}\n\nexport const postTag = async(ctx, next) => {\n  let body = ctx.request.body\n  let { name } = body\n\n  if (!name) {\n    return (ctx.body = {\n      success: false,\n      err: 'Tag name is required'\n    })\n  }\n\n  try {\n    body = new Tag(body)\n    await body.save()\n    ctx.body = {\n      success: true,\n      data: body\n    }\n  } catch (e) {\n    ctx.body = {\n      success: false,\n      err: e\n    }\n  }\n}\n\nexport const patchTag = async(ctx, next) => {\n  let body = ctx.request.body\n  body.updatedAt = Date.now()\n  const { id } = body\n  if (!id) {\n    return (ctx.body = {\n      success: false,\n      err: 'id is required'\n    })\n  }\n\n  try {\n    body = await Tag.findByIdAndUpdate(id, body).exec()\n    ctx.body = {\n      success: true,\n      data: body\n    }\n  } catch (e) {\n    ctx.body = {\n      success: false,\n      err: e\n    }\n  }\n}\n\nexport const deleteTag = async(ctx, next) => {\n  let { id } = ctx.params\n\n  if (!id) {\n    return (ctx.body = {\n      success: false,\n      err: 'id is required'\n    })\n  }\n\n  try {\n    let body = await Tag.findByIdAndRemove(id).exec()\n    ctx.body = {\n      success: true,\n      data: body\n    }\n  } catch (e) {\n    ctx.body = {\n      success: false,\n      err: e\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/tag.js","import mongoose from 'mongoose'\nimport jwt from 'jsonwebtoken'\nimport md5 from 'md5'\nimport config from '../config'\n\nconst User = mongoose.model('User')\n\nexport const login = async(ctx, next) => {\n  let { username, password } = ctx.request.body\n  password = md5(password)\n  try {\n    let user = await User.findOne({username: username, password: password}).exec()\n    let secret = config.jwt.secret\n    let expiresIn = config.jwt.expiresIn\n    let token = jwt.sign({ username: user.username, userID: user._id }, secret)\n    ctx.cookies.set('token', token)\n    ctx.body = {\n      success: true,\n      data: {\n        token: token\n      }\n    }\n  } catch (e) {\n    ctx.body = {\n      success: false,\n      data: e\n    }\n  }\n}\n\nexport const logout = async(ctx, next) => {\n  ctx.cookies.set('token', null)\n  ctx.body = {\n    success: true,\n    data: {}\n  }\n}\n\nexport const getUserInfo = async(ctx, next) => {\n  let avatarUrl = ctx.protocol + '://' + ctx.host + '/public/' + config.user.avatar\n  try {\n    let data = await User.findOne({ role: 'superAdmin' }).exec()\n    data.avatar = avatarUrl\n    ctx.body = {\n      success: true,\n      data: data\n    }\n  } catch (e) {\n    ctx.body = {\n      success: false,\n      err: e\n    }\n  }\n}\n\nexport const patchUserInfo = async(ctx, next) => {\n  let body = ctx.request.body\n\n  if (body.oldPassword && body.newPassword) {\n    // update password\n    let oldPassword = md5(body.oldPassword)\n    let newPassword = md5(body.newPassword)\n    try {\n      let user = await User.findOne({ role: 'superAdmin' }).exec()\n      if (user.password !== oldPassword) {\n        return (ctx.body = {\n          success: false,\n          err: 'Wrong password'\n        })\n      }\n      body = await User.findOneAndUpdate({ role: 'superAdmin' }, { password: newPassword, updatedAt: Date.now() }).exec()\n      ctx.body = {\n        success: true,\n        data: body\n      }\n    } catch (e) {\n      ctx.body = {\n        success: false,\n        err: e\n      }\n    }\n  } else {\n    // update info\n    body.updatedAt = Date.now()\n    try {\n      body = await User.findOneAndUpdate({ role: 'superAdmin' }, body).exec()\n      ctx.body = {\n        success: true,\n        data: body\n      }\n    } catch (e) {\n      ctx.body = {\n        success: false,\n        err: e\n      }\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/user.js","import mongoose from 'mongoose'\nimport jwt from 'jsonwebtoken'\nimport config from '../config'\nconst User = mongoose.model('User')\n\nexport default async(ctx, next) => {\n  const token = ctx.get('token')\n  // console.log('token: ', token)\n  if (token) {\n    const decoded = jwt.verify(token, config.jwt.secret)\n    const username = decoded.username\n    const userID = decoded.userID\n    try {\n      let user = await User.findOne({ _id: userID, username: username }).exec()\n      if (user._id && user.username) {\n        await next()\n      } else {\n        return (ctx.body = {\n          success: false,\n          err: 'Token is invalid'\n        })\n      }\n    } catch (e) {\n      return (ctx.body = {\n        success: false,\n        err: e\n      })\n    }\n  } else {\n    return (ctx.body = {\n      success: false,\n      err: 'Please login'\n    })\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/middlewares/check-token.js","import mongoose from 'mongoose'\nconst Schema = mongoose.Schema\n\nconst ArticleSchema = new Schema({\n  title: String,\n  content: String,\n  publish: {\n    type: Boolean,\n    default: false\n  },\n  views: {\n    type: Number,\n    default: 0\n  },\n  flag: {\n    type: Number,\n    default: 1\n  },\n  like: {\n    type: Array,\n    default: []\n  },\n  comments: {\n    type: Array,\n    default: []\n  },\n  tags: [{\n    type: Schema.Types.ObjectId,\n    ref: 'Tag'\n  }],\n  createdAt: {\n    type: Date,\n    default: Date.now\n  },\n  updatedAt: {\n    type: Date,\n    default: Date.now\n  }\n})\n\nArticleSchema.options.toJSON = {\n  virtuals: true,\n  versionKey: false,\n  transform(doc, ret) {\n    ret.id = ret._id\n    delete ret._id\n  }\n}\n// db.articles.update({}, {$set: {flag: 1}}, {multi: 1})\nmongoose.model('Article', ArticleSchema)\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/article.js","import mongoose from 'mongoose'\nimport md5 from 'md5'\nimport config from '../config'\n\nrequire('./user')\nrequire('./tag')\nrequire('./article')\n\nconst User = mongoose.model('User')\n\nconst mongoUrl = `mongodb://${config.mongodb.host}:${config.mongodb.port}/${config.mongodb.database}`\nmongoose.Promise = global.Promise\nmongoose.connection\n  .openUri(mongoUrl)\n  .once('open', async () => {\n    console.log('database connect successed')\n    // init admin information\n    let userInfo = config.user\n    userInfo.password = md5(userInfo.password)\n\n    let user = await User.findOne({ role: 'superAdmin' }).exec()\n    if (!user) {\n      user = new User(userInfo)\n      await user.save()\n      console.log('Administrator information initialization succeeded')\n    }\n  })\n  .on('error', (error) => {\n    console.warn('database connect fail', error)\n  })\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/index.js","import mongoose from 'mongoose'\nconst Schema = mongoose.Schema\n\nconst TagSchema = new Schema({\n  name: {\n    type: String,\n    default: ''\n  },\n  createdAt: {\n    type: Date,\n    default: Date.now\n  },\n  updatedAt: {\n    type: Date,\n    default: Date.now\n  }\n})\n\nTagSchema.options.toJSON = {\n  virtuals: true,\n  versionKey: false,\n  transform(doc, ret) {\n    ret.id = ret._id\n    delete ret._id\n  }\n}\n\nmongoose.model('Tag', TagSchema)\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/tag.js","import mongoose from 'mongoose'\nconst Schema = mongoose.Schema\n\nconst UserSchema = new Schema({\n  role: {\n    type: String,\n    default: 'user'\n  },\n  username: String,\n  password: String,\n  email: String,\n  nickname: String,\n  motto: String,\n  avatar: String,\n  createdAt: {\n    type: Date,\n    default: Date.now\n  },\n  updatedAt: {\n    type: Date,\n    default: Date.now\n  }\n})\n\n// hidden some field\nUserSchema.options.toJSON = {\n  virtuals: true,\n  versionKey: false,\n  transform(doc, ret) {\n    ret.id = ret._id\n    delete ret._id\n    delete ret.id\n    delete ret.password\n    delete ret.username\n  }\n}\nmongoose.model('User', UserSchema)\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/user.js","module.exports = (config) =>\r\n`User-agent: *\r\nAllow: /\r\nSitemap: ${config.siteUrl}/sitemap.xml\r\n\r\nUser-agent: YisouSpider\r\nDisallow: /\r\nUser-agent: EasouSpider\r\nDisallow: /\r\nUser-agent: EtaoSpider\r\nDisallow: /\r\nUser-agent: MJ12bot\r\nDisallow: /`\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/robots.js","let getUpdatedDate = date => `<lastBuildDate>${date}</lastBuildDate>\\r\\n`\r\nlet tail = `</channel>\r\n</rss>`\r\n\r\nlet getRssBodyFromBody = (result, config) => {\r\n  let head = `<rss xmlns:atom=\"http://www.w3.org/2005/Atom\" version=\"2.0\">\r\n  <channel>\r\n    <title>${config.title}</title>\r\n    <link>${config.siteUrl}</link>\r\n    <description>${config.description}</description>\r\n    <atom:link href=\"${config.siteUrl}/rss.xml\" rel=\"self\"/>\r\n    <language>zh-CN</language>\\r\\n`\r\n  let body = result.data.reduce((prev, curr) => {\r\n    let date = new Date(curr.updatedAt).toUTCString()\r\n    let content = curr.content\r\n      .replace(/&/g, '&amp;')\r\n      .replace(/</g, '&lt;')\r\n      .replace(/>/g, '&gt;')\r\n      .replace(/\"/g, '&quot;')\r\n      .replace(/'/g, '&apos;')\r\n    prev += `    <item>\\r\\n`\r\n    prev += `      <title>${curr.title}</title>\\r\\n`\r\n    prev += `      <link>${config.siteUrl}/detail/${curr.id}</link>\\r\\n`\r\n    prev += `      <description>${content}</description>\\r\\n`\r\n    prev += `      <pubDate>${date}</pubDate>\\r\\n`\r\n    prev += `      <guid>${config.siteUrl}/detail/${curr.id}</guid>\\r\\n`\r\n    prev += `    </item>\\r\\n`\r\n    return prev\r\n  }, '')\r\n  return head + getUpdatedDate(new Date().toUTCString()) + body + tail\r\n}\r\n\r\nmodule.exports = {\r\n  getRssBodyFromBody\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/rss.js","let head = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\\r\\n`\r\n\r\nlet tail = '</urlset>'\r\nlet getSitemapFromBody = (result, config) => {\r\n  let res = result.data\r\n  let body = res.reduce((prev, curr) => {\r\n    prev += `  <url>\\r\\n`\r\n    prev += `    <loc>${config.siteUrl}/detail/${curr.id}</loc>\\r\\n`\r\n    prev += `    <lastmod>${curr.updatedAt.slice(0, 10)}</lastmod>\\r\\n`\r\n    prev += `    <priority>0.6</priority>\\r\\n`\r\n    prev += `  </url>\\r\\n`\r\n    return prev\r\n  }, '')\r\n  return head + body + tail\r\n}\r\n\r\nmodule.exports = {\r\n  getSitemapFromBody\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/sitemap.js","module.exports = require(\"axios\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"axios\"\n// module id = 24\n// module chunks = 0","module.exports = require(\"formidable\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"formidable\"\n// module id = 25\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 26\n// module chunks = 0","module.exports = require(\"os\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"os\"\n// module id = 27\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 28\n// module chunks = 0","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 29\n// module chunks = 0","import Koa from 'koa'\nimport { Nuxt, Builder } from 'nuxt'\nimport KoaStatic from 'koa-static'\nimport bodyParser from 'koa-bodyparser'\nimport Router from 'koa-router'\nimport cors from '@koa/cors'\nimport globalConfig from './config'\nimport route from './routes'\n\nasync function start() {\n  const app = new Koa()\n  const host = process.env.HOST || globalConfig.app.host\n  const port = process.env.PORT || globalConfig.app.port\n  const router = new Router()\n\n  /* app.get('/rss.xml', (ctx, next) => {\n    ctx.res.end('good')\n    next()\n   })\n  */\n  app.use(cors())\n  app.use(bodyParser())\n  app.use(KoaStatic('.'))\n  router.use('', route.routes())\n  app\n  .use(router.routes())\n  .use(router.allowedMethods())\n\n  // Import and Set Nuxt.js options\n  let config = require('../nuxt.config.js')\n  config.dev = !(app.env === 'production')\n\n  // Instantiate nuxt.js\n  const nuxt = new Nuxt(config)\n\n  // Build in development\n  if (config.dev) {\n    const builder = new Builder(nuxt)\n    await builder.build()\n  }\n\n  app.use(async (ctx, next) => {\n    await next()\n    ctx.status = 200 // koa defaults to 404 when it sees that status is unset\n    return new Promise((resolve, reject) => {\n      ctx.res.on('close', resolve)\n      ctx.res.on('finish', resolve)\n      nuxt.render(ctx.req, ctx.res, promise => {\n        // nuxt.render passes a rejected promise into callback on error.\n        promise.then(resolve).catch(reject)\n      })\n    })\n  })\n\n  app.listen(port, host)\n  console.log('Server listening on ' + host + ':' + port) // eslint-disable-line no-console\n}\n\nstart()\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.js"],"sourceRoot":""}